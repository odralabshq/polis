# =============================================================================
# Molis Approval System Configuration
# =============================================================================
# Time-gate, domain allowlist, and TTL settings for the HITL approval
# system (REQMOD rewriter + RESPMOD scanner). Loaded by both c-ICAP
# approval modules at service initialization.
#
# Format:
#   time_gate_secs       = <seconds>   — delay before OTT becomes valid
#   approval_domain.<N>  = <domain>    — dot-prefixed domain allowlist entry
#   ott_ttl_secs         = <seconds>   — OTT mapping expiry in Valkey
#   approval_ttl_secs    = <seconds>   — approved key expiry in Valkey
# =============================================================================

# -----------------------------------------------------------------------------
# Time-Gate
# -----------------------------------------------------------------------------
# Minimum delay (seconds) before an OTT code becomes valid for approval.
# Prevents agent self-approval via sendMessage API echo responses: the
# agent's own outbound message is echoed back within milliseconds, but
# the OTT is not armed until this delay has elapsed.
#
# Can be overridden at runtime via MOLIS_APPROVAL_TIME_GATE_SECS env var.

time_gate_secs = 15

# -----------------------------------------------------------------------------
# Domain Allowlist
# -----------------------------------------------------------------------------
# Dot-prefixed domains from which RESPMOD will accept OTT approvals.
# RESPMOD ignores responses from any host not matching this list.
#
# IMPORTANT — Dot-Prefix Requirement (CWE-346):
#   All entries MUST use a leading dot (e.g., ".api.slack.com") to enforce
#   dot-boundary matching. This prevents subdomain spoofing attacks:
#
#     ".slack.com"  matches "api.slack.com"    (dot boundary before suffix)
#     ".slack.com"  does NOT match "evil-slack.com"  (no dot boundary)
#
#   Without the leading dot, an attacker could register "evil-slack.com"
#   and have it accepted as a valid approval source. The dot prefix
#   guarantees that only legitimate subdomains are matched.
#
# Can be overridden at runtime via MOLIS_APPROVAL_DOMAINS env var
# (comma-separated, dot-prefixed).

approval_domain.0 = .api.telegram.org
approval_domain.1 = .api.slack.com
approval_domain.2 = .discord.com

# -----------------------------------------------------------------------------
# TTL Settings
# -----------------------------------------------------------------------------
# OTT mapping TTL: how long an OTT code remains valid in Valkey before
# automatic expiry. After this period, the OTT can no longer be used
# for approval and must be regenerated.

ott_ttl_secs = 600

# Approval TTL: how long an approved request remains in Valkey after
# approval. The MCP agent must poll and act on the approval within
# this window, after which the approval expires and the request must
# be re-approved.

approval_ttl_secs = 300
