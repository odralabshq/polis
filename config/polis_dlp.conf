# =============================================================================
# polis DLP Configuration
# =============================================================================
# Credential detection patterns, allow rules, and actions for the
# srv_polis_dlp c-ICAP module. Loaded at service initialization.
#
# Format:
#   pattern.<name> = <regex>          — credential detection pattern
#   allow.<name>   = <domain_regex>   — expected destination (allow if matched)
#   action.<name>  = block            — always block regardless of destination
#   default_action = block            — default action when no allow rule matches
#
# Patterns without an allow rule and without an explicit action use
# default_action (block).
# =============================================================================

# -----------------------------------------------------------------------------
# Credential Patterns
# -----------------------------------------------------------------------------

# Anthropic API keys
pattern.anthropic = sk-ant-api[a-zA-Z0-9_-]{20,128}

# OpenAI API keys
pattern.openai = sk-proj-[a-zA-Z0-9_-]{20,128}

# GitHub Personal Access Tokens
pattern.github_pat = ghp_[a-zA-Z0-9]{36}

# GitHub OAuth tokens
pattern.github_oauth = gho_[a-zA-Z0-9]{36}

# AWS Access Key IDs
pattern.aws_access = AKIA[A-Z0-9]{16}

# AWS Secret Access Keys
pattern.aws_secret = [a-zA-Z0-9/+=]{40}

# RSA Private Keys
pattern.rsa_key = -----BEGIN RSA PRIVATE KEY-----

# OpenSSH Private Keys
pattern.openssh_key = -----BEGIN OPENSSH PRIVATE KEY-----

# EC Private Keys
pattern.ec_key = -----BEGIN EC PRIVATE KEY-----

# -----------------------------------------------------------------------------
# Allow Rules — Expected Destinations
# -----------------------------------------------------------------------------
# Credentials matching a pattern are allowed through if the request Host
# header matches the corresponding allow rule. Otherwise, default_action
# applies.

# Anthropic keys → Anthropic API
allow.anthropic = ^api\.anthropic\.com$

# OpenAI keys → OpenAI API
allow.openai = ^api\.openai\.com$

# GitHub PATs → GitHub API or github.com
allow.github_pat = ^(api\.)?github\.com$

# GitHub OAuth tokens → GitHub API or github.com
allow.github_oauth = ^(api\.)?github\.com$

# AWS Access Keys → AWS services
allow.aws_access = ^[a-z0-9-]+\.amazonaws\.com$

# AWS Secret Keys → AWS services
allow.aws_secret = ^[a-z0-9-]+\.amazonaws\.com$

# NOTE: rsa_key, openssh_key, ec_key have NO allow rules — they are
# always blocked via the action directives below.

# -----------------------------------------------------------------------------
# Actions — Always Block
# -----------------------------------------------------------------------------
# Private keys are always blocked regardless of destination.

action.rsa_key = block
action.openssh_key = block
action.ec_key = block

# -----------------------------------------------------------------------------
# Default Action
# -----------------------------------------------------------------------------
# When a credential is detected and no allow rule matches, block the request.

default_action = block
