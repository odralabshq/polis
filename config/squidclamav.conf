# SquidClamav Configuration for Molis v0.2.5
# Fail-closed malware scanning

# Logging (handled by c-icap ServerLog)
# Debug level 0-3 (0=off, 3=verbose)
# Set via c-icap DebugLevel directive

# ClamAV daemon connection (TCP for Docker networking)
clamd_ip clamav
clamd_port 3310

# Connection timeout (seconds)
timeout 3

# Maximum file size to scan (0 = no limit, use clamd StreamMaxLength)
maxsize 10M

# Enable DNS lookup of client IP (disable for performance)
dnslookup 0

# Log redirections (virus detections)
logredir 1

# Scan mode: ScanAllExcept (default) or ScanNothingExcept
scan_mode ScanAllExcept

# SECURITY: No abort/abortcontent directives - scan ALL content
# ClamAV uses magic bytes for file type detection, not extensions/MIME types
# Removed bypass rules that allowed extension/MIME spoofing attacks

# Scan these file types regardless (defense in depth for high-risk types)
scan .*\.(exe|dll|msi|bat|cmd|ps1|vbs|js|jar|zip|rar|7z|tar|gz|doc|docx|xls|xlsx|ppt|pptx|pdf)$
