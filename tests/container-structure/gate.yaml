# container-structure-test for polis-gate
# Validates g3proxy transparent proxy image

schemaVersion: '2.0.0'

metadataTest:
  user: "65532"
  workdir: "/"

fileExistenceTests:
  - name: 'g3proxy binary'
    path: '/usr/bin/g3proxy'
    shouldExist: true
    permissions: '-rwxr-xr-x'

  - name: 'g3proxy config'
    path: '/etc/g3proxy/g3proxy.yaml'
    shouldExist: true

  - name: 'init script'
    path: '/usr/local/bin/init.sh'
    shouldExist: true
    permissions: '-rwxr-xr-x'

  - name: 'iptables binary'
    path: '/usr/sbin/iptables'
    shouldExist: true

commandTests:
  - name: 'g3proxy version'
    command: '/usr/bin/g3proxy'
    args: ['--version']
    exitCode: 0
    expectedOutput: ['g3proxy']

  - name: 'iptables available'
    command: 'which'
    args: ['iptables']
    exitCode: 0
