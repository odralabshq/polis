# container-structure-test for polis-sentinel
# Validates c-icap server with DLP/ClamAV modules

schemaVersion: '2.0.0'

metadataTest:
  user: "65532"

fileExistenceTests:
  - name: 'c-icap binary'
    path: '/usr/bin/c-icap'
    shouldExist: true

  - name: 'DLP module'
    path: '/usr/local/lib/c_icap/srv_polis_dlp.so'
    shouldExist: true

  - name: 'approval rewrite module'
    path: '/usr/local/lib/c_icap/srv_polis_approval_rewrite.so'
    shouldExist: true

  - name: 'approval module'
    path: '/usr/local/lib/c_icap/srv_polis_approval.so'
    shouldExist: true

  - name: 'sentinel respmod module'
    path: '/usr/local/lib/c_icap/srv_polis_sentinel_resp.so'
    shouldExist: true

  - name: 'squidclamav module'
    path: '/usr/lib/c_icap/squidclamav.so'
    shouldExist: true

  - name: 'entrypoint'
    path: '/entrypoint.sh'
    shouldExist: true
    permissions: '-rwxr-xr-x'

commandTests:
  - name: 'c-icap help'
    command: '/usr/bin/c-icap'
    args: ['-h']
    exitCode: 0
