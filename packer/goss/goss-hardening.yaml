# goss-hardening.yaml - VM hardening validation (CIS-aligned)

file:
  /etc/sysctl.d/99-polis-hardening.conf:
    exists: true
    contents:
      - "kernel.randomize_va_space = 2"
      - "kernel.dmesg_restrict = 1"
      - "kernel.kptr_restrict = 2"
      - "fs.suid_dumpable = 0"
      - "kernel.yama.ptrace_scope = 2"

  /etc/audit/rules.d/docker.rules:
    exists: true
    skip: true

package:
  auditd:
    installed: true

service:
  apparmor:
    enabled: true
    running: true

  auditd:
    enabled: true
    running: true

# Verify sysctl values are applied
command:
  sysctl-aslr:
    exec: "sysctl -n kernel.randomize_va_space"
    exit-status: 0
    stdout:
      - "2"

  sysctl-dmesg:
    exec: "sysctl -n kernel.dmesg_restrict"
    exit-status: 0
    stdout:
      - "1"

  sysctl-kptr:
    exec: "sysctl -n kernel.kptr_restrict"
    exit-status: 0
    stdout:
      - "2"

# Verify user accounts are locked
command:
  ubuntu-locked:
    exec: "sudo passwd -S ubuntu | cut -d' ' -f2"
    exit-status: 0
    stdout:
      - "L"

  root-locked:
    exec: "sudo passwd -S root | cut -d' ' -f2"
    exit-status: 0
    stdout:
      - "L"
